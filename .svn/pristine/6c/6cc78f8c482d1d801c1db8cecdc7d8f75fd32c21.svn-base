// pages/shoppingcart/index.js
Component({
  properties: {
    commodity: Object,
  },

  data: {
    touchStart: null,
    rightSpace: 0,
    selectedNum: 1,
  },

  methods: {
    /* 商品是否选中 */
    handleSelect() {
      let selectedNum = this.data.selectedNum;
      let commodity = this.data.commodity;
      if (commodity.isselected == 0) {
        commodity.isselected = 1;
      } else {
        commodity.isselected = 0;
      }
      this.triggerEvent('handleselect', { commodity, selectedNum })
    },
    /* 处理触摸滑动开始 */
    handleTouchStart(e) {
      /* 记录触摸滑动初始位置 */
      let touchStart = e.changedTouches[0].clientX;
      this.setData({
        touchStart
      })
    },
    /* 处理触摸滑动 */
    handleTouchMove(e) {
      console.log(e)
      let moveSpace = e.changedTouches[0].clientX;
      let touchStart = this.data.touchStart;
      if (touchStart != null) {
        if (moveSpace - touchStart > 70) {
          this.setData({
            touchStart: null,
            rightSpace: 0
          })
        }
        else if (moveSpace - touchStart < -70) {
          this.setData({
            touchStart: null,
            rightSpace: 70
          })
        }
      }
    },
    numChange(e) {
      let selectedNum = e.detail.value;
      let commodity = this.data.commodity;
      this.setData({
        selectedNum
      })
      this.triggerEvent('handleselect', { commodity, selectedNum })
    },
    add: function (e) {
      var cartList = this.data.cartList   //获取购物车列表
      var index = e.currentTarget.dataset.index //获取当前点击事件的下标索引
      var value = cartList[index].quantity  //获取购物车里面的value值
      value++
      cartList[index].quantity = value;
      this.setData({
        cartList: cartList
      });
      this.getsumTotal()
      wx.setStorageSync("cartList", cartList)  //存缓存
    },
    //减
    reduce: function (e) {
      var commodity = this.data.commodity  //获取购物车列表
      var index = e.currentTarget.dataset.index  //获取当前点击事件的下标索引
      var value = commodity[index].quantity  //获取购物车里面的value值
      if (value == 1) {
        value--
        commodity[index].quantity = 1
      } else {
        value--
        commodity[index].quantity = value;
      }
      this.setData({
        commodity: commodity
      });
      this.getsumTotal()
      wx.setStorageSync("commodity", commodity)
    },
  },

})